if(!Array.indexOf){Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return a}}return -1}}Date.prototype.format=function(b){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(b)){b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var a in c){if(new RegExp("("+a+")").test(b)){b=b.replace(RegExp.$1,RegExp.$1.length==1?c[a]:("00"+c[a]).substr((""+c[a]).length))}}return b};Number.prototype.toPercent=function(){return Math.round(this*10000)/100+"%"};$(document).ready(function(){PayCommon.init()});PayCommon={safeCodeElements:[],safeCodeCallback:null,init:function(){PayCommon.initEvent();PayCommon.initBankImg();PayCommon.adjustPosition();PayCommon.initCrumbs();PayCommon.updateLoginInfo();PayCommon.showPhoneCode()},initEvent:function(){$(".logout_user").on("click",PayCommon.logout);$(window).on("resize",PayCommon.adjustPosition);$(".btn-again-send").on("click",function(){$("#phoneCode").removeAttr("disabled");PayCommon.sendPhoneSMS($(this).attr("phoneType"));PayCommon.sendMsgAgain(this)})},updateLoginInfo:function(){$.ajax({url:Helper.getRootPath()+"/user/getMerchantInfo.do",type:"post",dataType:"json",data:{},success:function(a){if(a){PayCommon.updateLoginName(a.loginName);PayCommon.updateMerchantBalance(Helper.toMoney(a.balance));if(a.isTipFastRemit===true){$(".api-no-bind-ip").show()}else{$(".api-no-bind-ip").hide();$(".api-no-bind-ip").remove()}if(!a.isMaster&&a.remitConfig==2){$("#merchant_balance_info_html").html("当日可用配额")}if("1"==a.proxy){$(".agency-menu").show();if(!a.parentStatus){$("ul li[name='agentAccountName']").remove()}}}else{Helper.alert("系统忙， 请稍候再试")}}})},updateLoginName:function(a){$(".login-name").html(a)},updateMerchantBalance:function(a){$(".merchant-balance").html(a);$(".merchant-balance").fadeIn()},getTimeByDateStr:function(b){var c=parseInt(b.substring(0,4));var d=parseInt(b.substring(5,7),10)-1;var a=parseInt(b.substring(8,10),10);return new Date(c,d,a).getTime()},checkDateScopeByTime:function(d,b){var c=PayCommon.getTimeByDateStr(d);var a=PayCommon.getTimeByDateStr(b);if((a-c)>29*24*60*60*1000){return false}else{return true}},initBar:function(){var a=(window.location+"").split("/");var f="-1";for(var c in a){if((""+a[c]).indexOf(".do")>=0){f=a[c];break}}var b=null;var e=$("#side_accordion").find(".accordion-toggle");$.each(e,function(j,k){var h=""+k.href;if((h).indexOf(f)>=0&&h.indexOf("#")<0){b=k;return false}});var d=false;if(b!=null){$(b).parent(".accordion-heading").addClass("sdb_h_active");d=true}else{var g=$("#side_accordion").find(".accordion-body").find("a");$.each(g,function(j,l){var h=""+l.href;if((h).indexOf(f)>=0&&h.indexOf("#")<0){$(l).parent("li").addClass("active");var k=$(l).parents(".accordion-body");if(k){k.prev(".accordion-heading").addClass("sdb_h_active");k.addClass("in");d=true}return false}})}if(!d){PayCommon.specialSelectedMenu(f)}},specialSelectedMenu:function(a){if(a.indexOf("receptionOrderEdit.do")>=0){$("#side_accordion").find(".accordion-heading").first().addClass("sdb_h_active")}else{if(a.indexOf("orderEdit.do")>=0){$("#side_accordion").children("div").eq(1).addClass("sdb_h_active")}else{if(a.indexOf("payAccountCardBing.do")>=0){var b=$("#side_accordion").find(".accordion-heading").eq(3);b.addClass("sdb_h_active");var c=$("#collapseTwo");c.addClass("in");if(c){c.find("li:first").addClass("active")}}}}},make_active:function(){var a=$("#side_accordion");a.find(".accordion-heading").removeClass("sdb_h_active");var c=a.find(".accordion-body.in").prev(".accordion-heading");if(c.length){c.addClass("sdb_h_active")}var b=$("#container").height()},initCrumbs:function(){if($(".breadCrumb").length){$(".breadCrumb").jBreadCrumb({endElementsToLeaveOpen:0,beginingElementsToLeaveOpen:0,timeExpansionAnimation:500,timeCompressionAnimation:500,timeInitialCollapse:500,previewWidth:50})}},sendMsgCurCount:60,sendMsgAgain:function(a){if(PayCommon.sendMsgCurCount==0){$(".btn-again-send").addClass("btn-success");$(a).removeAttr("disabled").html("重新发送");PayCommon.sendMsgCurCount=60}else{$(".btn-again-send").removeClass("btn-success");$(a).attr("disabled",true).html("重新发送("+PayCommon.sendMsgCurCount+"s)");PayCommon.sendMsgCurCount--;PayCommon.sendMsgTimer=setTimeout(function(){PayCommon.sendMsgAgain(a)},1000)}},sendPhoneSMS:function(a){$.ajax({url:Helper.getRootPath()+"/pub/sendPhoneSMS.do",type:"post",dataType:"json",data:{type:a},success:function(b){if(b.status=="0"){Helper.alert(b.errorInfo)}}})},fetchSafecode:function(){$.ajax({url:Helper.getRootPath()+"/login/checkSafecode.do",type:"post",dataType:"json",data:{},success:function(a){if(a.safecodeSet){location.href=Helper.getRootPath()+"/account/getKey.do"}else{location.href=Helper.getRootPath()+"/account/showKeyMsg.do"}}})},logout:function(){Helper.confirm("确认要退出?",function(){$.ajax({url:Helper.getRootPath()+"/user/logout.do",type:"post",dataType:"json",data:{},success:function(a){if(a.status){location.href=Helper.getWebRootPath()}}})})},adjustPosition:function(){var a=parseInt(document.body.clientHeight),b=parseInt(document.getElementById("copyright").clientHeight),c=(a-b-1).toString()+"px";if($("#copyright").length>0){document.getElementById("h_body").style.height=c}},calculate:function(){var val="";try{val=eval(Calc.calculate_input.value);val=Math.round(val*1000)/1000;Calc.calculate_input.value=val}catch(e){Helper.alert("输入的表达式不合法！");$("#calculate_input").focus()}},initBankImg:function(){$("#Bank ul li").mouseover(function(){var a=$(this).attr("class");$(this).removeClass(a);$(this).addClass(a+"-1")});$("#Bank ul li").mouseout(function(){var a=$(this).attr("class").replace("-1","");$(this).removeClass($(this).attr("class"));$(this).addClass(a)})},checkSafeCode:function(a,b){if(a==""){Helper.alert("安全码不能为空");return}$.ajax({type:"POST",url:Helper.getRootPath()+"/account/checkKey.do",data:{safeCode:a},cache:false,dataType:"json",success:function(c){if(c.code==0){Helper.alert("安全码输入不正确!")}else{if(b){b(c.key)}}}})},checkBankCardNo:function(e){var o="10,18,30,35,37,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,58,60,62,65,68,69,84,87,88,94,95,98,99";if(o.indexOf(e.substring(0,2))==-1){return false}var y=e.substr(e.length-1,1);var b=e.substr(0,e.length-1);var B=new Array();for(var x=b.length-1;x>-1;x--){B.push(b.substr(x,1))}var t=new Array();var a=new Array();var g=new Array();for(var w=0;w<B.length;w++){if((w+1)%2==1){if(parseInt(B[w])*2<9){t.push(parseInt(B[w])*2)}else{a.push(parseInt(B[w])*2)}}else{g.push(B[w])}}var d=new Array();var c=new Array();for(var z=0;z<a.length;z++){d.push(parseInt(a[z])%10);c.push(parseInt(a[z])/10)}var A=0;var v=0;var l=0;var f=0;var D=0;for(var s=0;s<t.length;s++){A=A+parseInt(t[s])}for(var r=0;r<g.length;r++){v=v+parseInt(g[r])}for(var q=0;q<d.length;q++){l=l+parseInt(d[q]);f=f+parseInt(c[q])}D=parseInt(A)+parseInt(v)+parseInt(l)+parseInt(f);var u=parseInt(D)%10==0?10:parseInt(D)%10;var C=10-u;if(y==C){return true}else{return false}},retrieveSafeCode:function(){$(".retrieve-safe-code").attr("disabled","true");$.ajax({url:Helper.getRootPath()+"/retrieve/sendRetrieveSafeCodeMail.do",type:"post",dataType:"json",data:{},success:function(a){$(".retrieve-safe-code").removeAttr("disabled");if(a.status==1){Helper.alert("邮件发送成功")}else{Helper.alert(a.errorInfo)}},error:function(c,a,b){Helper.alert("找回密码失败");$(".retrieve-safe-code").removeAttr("disabled")}})},getUserEncryCode:function(a){Helper.getUserEncryCode(a)},initSafeCode:function(){$(".auth-code-img").on("click",PayCommon.genAuthCodeImg);PayCommon.genAuthCodeImg();PayCommon.initSafeCodeTip()},loadSafeCodeModal:function(b){PayCommon.safeCodeCallback=b;$("#safe_code_modal").modal({backdrop:"static"});$("#safe_code_modal").on("hidden.bs.modal",function(c){PayCommon.resetTipForm()});var a=$.trim($("#user_encry_code").val());if(a==""){Helper.getUserEncryCode("user_encry_code")}},initSafeCodeTip:function(){var a=$("#safeCodeModal").val();if(a==1){$(".form_validation_safe_code_tip").validate({onkeyup:false,errorClass:"error",validClass:"valid",highlight:function(b){$(b).closest("div").addClass("f_error")},unhighlight:function(b){$(b).closest("div").removeClass("f_error")},rules:{safe_code:{required:true,isPwd:true},confirm_safe_code:{required:true,equalTo:"#safe_code"},auth_code:{required:true}},messages:{safe_code:{required:"安全码不能为空",isPwd:"安全码只能包含字母、数字和下划线，长度在6-20之间"},confirm_safe_code:{required:"确认安全码不能为空",equalTo:"安全码与确认安全码不一致"},auth_code:{required:"验证码不能为空"}},invalidHandler:function(c,b){},errorPlacement:function(c,d){var e=$(d);PayCommon.safeCodeElements.push(e);if(!c.is(":empty")){if((e.is(":checkbox"))||(e.is(":radio"))){e.filter(":not(.valid)").parent("label").parent("div").find(".error_placement").qtip({overwrite:false,content:c,position:{my:"left center",at:"center right",viewport:$(window),adjust:{x:6}},show:{event:false,ready:true},hide:false,style:{classes:"ui-tooltip-red ui-tooltip-rounded"}}).qtip("option","content.text",c)}else{var b=5;if(e.attr("name")=="auth_code"){b=110}e.filter(":not(.valid)").qtip({overwrite:false,content:c,position:{my:"left center",at:"center right",viewport:$(window),adjust:{x:b,y:0}},show:{event:false,ready:true},hide:false,style:{classes:"ui-tooltip-red ui-tooltip-rounded"}}).qtip("option","content.text",c)}}else{if((e.is(":checkbox"))||(e.is(":radio"))){e.parent("label").parent("div").find(".error_placement").qtip("destroy")}else{e.qtip("destroy")}}},submitHandler:function(b){PayCommon.updateSafeCode();return false},success:$.noop})}},updateSafeCode:function(){var d=$("#safe_code").val();var e=$.md5(d);var c=$.trim($("#user_encry_code").val());var b=Helper.md6(e,c);var a=$.trim($("#auth_code").val());$.ajax({type:"POST",url:Helper.getRootPath()+"/user/setSafeCode.do",data:{safecode:b,authCode:a},cache:false,dataType:"json",success:function(f){if(f.code=="1"){if(PayCommon.safeCodeCallback){PayCommon.safeCodeCallback(d)}else{Helper.alert("安全码设置成功")}$("#safe_code_modal").modal("hide")}else{PayCommon.genAuthCodeImg();Helper.alert(f.errorInfo)}}})},genAuthCodeImg:function(){var a=Helper.genAuthCode(11);$("#auth_code_img").attr("src",a)},resetTipForm:function(){$.each(PayCommon.safeCodeElements,function(a,b){b.qtip("destroy")})},genBankInfoList:function(){$.ajax({type:"get",url:Helper.getRootPath()+"/pub/listBankInfo.do",data:{enableRemit:"1"},cache:false,dataType:"json",success:function(c){var b=c.bankInfoList;for(var a=0;a<b.length;a++){$("[name='bankCardType']").append("<option value='"+b[a].bankCode+"'>"+b[a].bankName+"</option>")}}})},genReceiptOrderStatus:function(){var a=$("#orderStatus");a.append("<option value='1'>待付款</option>");a.append("<option value='2'>成功</option>");a.append("<option value='3'>失败</option>")},genRemitOrderStatus:function(){var a=$("#orderStatus");a.append("<option value='1'>系统处理中</option>");a.append("<option value='2'>银行处理中</option>");a.append("<option value='3'>成功</option>");a.append("<option value='4'>失败</option>")},genRemitType:function(){var a=$("#remitType");a.append("<option value='0'>后台</option>");a.append("<option value='1'>接口</option>")},genPaymentOrderStatus:function(){var a=$("#receiptRemitType");a.append("<option value='1'>收款成功</option>");a.append("<option value='2'>结算失败金额返还</option>");a.append("<option value='3'>结算失败手续费返还</option>");a.append("<option value='4'>系统加款</option>");a.append("<option value='5'>收款手续费</option>");a.append("<option value='6'>结算成功</option>");a.append("<option value='7'>结算手续费</option>");a.append("<option value='8'>系统扣款</option>");a.append("<option value='9'>账户间转出</option>");a.append("<option value='10'>账户间转入</option>")},genCurUserAndSub:function(){$.ajax({type:"POST",url:Helper.getRootPath()+"/pub/getCurUserAndSub.do",data:{},cache:false,dataType:"json",success:function(a){if(a.status){var b=$("#operUserName");if(a.remitConfig=="1"){$.each(a.subList,function(c,d){b.append("<option value='"+d+"'>"+d+"</option>")})}else{b.parent().remove()}}else{Helper.alert(a.errorInfo);return false}}})},showPhoneCode:function(){if($("#phoneCode").length>0){$("#phoneCode").attr("disabled","true")}},getYMD:function(){var b=new Date();var e=b.getFullYear();var a=b.getMonth()+1;if(a<10){a="0"+a}var c=b.getDate();if(c<10){c="0"+c}return e+"-"+a+"-"+c}};gebo_tips={init:function(){if(!is_touch_device()){var a={style:{classes:"ui-tooltip-shadow ui-tooltip-tipsy"},show:{delay:100},hide:{delay:0}};if($(".ttip_b").length){$(".ttip_b").qtip($.extend({},a,{position:{my:"top center",at:"bottom center",viewport:$(window)}}))}if($(".ttip_t").length){$(".ttip_t").qtip($.extend({},a,{position:{my:"bottom center",at:"top center",viewport:$(window)}}))}if($(".ttip_l").length){$(".ttip_l").qtip($.extend({},a,{position:{my:"right center",at:"left center",viewport:$(window)}}))}if($(".ttip_r").length){$(".ttip_r").qtip($.extend({},a,{position:{my:"left center",at:"right center",viewport:$(window)}}))}}}};var Calculator={cleanInput:function(){Calc.Input.value=""},addDigit:function(a){var b=$(this).val();Calc.Input.value+=b},addOperator:function(a){var b=$(this).val();Calc.Input.value+=" "+b+" "},calculate:function(){Calc.Input.value=Math.round(eval(Calc.Input.value)*1000)/1000}};